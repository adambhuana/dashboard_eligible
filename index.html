<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Dashboard Analitik Mahasiswa</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .program-badge {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
        }
        
        .upload-section {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin: 20px 0;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        
        .file-input-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .file-input-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .file-list {
            margin-top: 15px;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .file-item {
            background: #f8f9ff;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-item-name {
            color: #667eea;
            font-weight: 600;
            font-size: 14px;
        }
        
        .file-item-remove {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .process-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .process-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .process-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .program-filter {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            padding: 12px 25px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: #f8f9ff;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }
        
        .analytics-grid {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-subtext {
            color: #999;
            font-size: 13px;
            margin-top: 10px;
        }
        
        .tabs {
            display: none;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            background: white;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #f8f9ff;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .charts-section {
            display: none;
        }
        
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .chart-container h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin: 0 auto;
        }
        
        .chart-wrapper.small {
            height: 300px;
        }
        
        .insights-section {
            display: none;
        }
        
        .insight-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-left: 5px solid #667eea;
        }
        
        .insight-card h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .insight-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .insight-highlight {
            background: #f8f9ff;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            color: #667eea;
            font-weight: 600;
        }
        
        .table-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            color: #333;
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: #f8f9ff;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .badge-primary {
            background: #cfe2ff;
            color: #084298;
        }
        
        .badge-purple {
            background: #e8e3ff;
            color: #5a3d99;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .table-controls {
                flex-direction: column;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px;
            }
            
            .filter-buttons {
                flex-direction: column;
            }
            
            .filter-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Dashboard Analitik Mahasiswa</h1>
            <p>Analisis Komprehensif Status Mahasiswa - Semester Ganjil 2025</p>
            <div id="programBadges" style="margin-top: 15px;"></div>
        </div>
        
        <div class="upload-section" id="uploadSection">
            <h2 style="margin-bottom: 15px; color: #333;">üìÇ Upload File Excel</h2>
            <p style="color: #666; margin-bottom: 20px;">
                Upload 1 atau lebih file Excel data mahasiswa<br>
                <small>Mendukung: Sains Data & Sistem dan Teknologi Informasi</small>
            </p>
            
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" accept=".xlsx,.xls" multiple onchange="handleFileSelect(event)">
                <div class="file-input-button">
                    üìÅ Pilih File Excel (bisa multiple)
                </div>
            </div>
            
            <div class="file-list" id="fileList"></div>
            
            <button class="process-btn" id="processBtn" onclick="processAllFiles()" style="display: none;">
                üöÄ Proses Data
            </button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #667eea; font-weight: 600;">Memproses data...</p>
            </div>
        </div>
        
        <div class="program-filter" id="programFilter">
            <h3 style="text-align: center; margin-bottom: 15px; color: #333;">üéì Filter Program Studi</h3>
            <div class="filter-buttons" id="filterButtons"></div>
        </div>
        
        <div class="tabs" id="tabsSection">
            <div class="tab active" onclick="switchTab('overview')">üìä Overview</div>
            <div class="tab" onclick="switchTab('charts')">üìà Charts</div>
            <div class="tab" onclick="switchTab('insights')">üí° Insights</div>
            <div class="tab" onclick="switchTab('data')">üìã Data Table</div>
        </div>
        
        <!-- Overview Tab -->
        <div id="overviewTab" class="tab-content">
            <div class="analytics-grid" id="statsGrid"></div>
        </div>
        
        <!-- Charts Tab -->
        <div id="chartsTab" class="tab-content" style="display: none;">
            <div class="charts-section" id="chartsSection"></div>
        </div>
        
        <!-- Insights Tab -->
        <div id="insightsTab" class="tab-content" style="display: none;">
            <div class="insights-section" id="insightsSection"></div>
        </div>
        
        <!-- Data Table Tab -->
        <div id="dataTab" class="tab-content" style="display: none;">
            <div class="table-section" id="tableSection"></div>
        </div>
    </div>

    <script>
        let allStudentsData = [];
        let filteredData = [];
        let selectedFiles = [];
        let currentProgramFilter = 'all';
        let availablePrograms = [];
        let chartInstances = {};
        
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            selectedFiles = [...selectedFiles, ...files];
            renderFileList();
            
            if (selectedFiles.length > 0) {
                document.getElementById('processBtn').style.display = 'inline-block';
            }
        }
        
        function renderFileList() {
            const container = document.getElementById('fileList');
            if (selectedFiles.length === 0) {
                container.innerHTML = '';
                document.getElementById('processBtn').style.display = 'none';
                return;
            }
            
            container.innerHTML = '<p style="color: #666; font-weight: 600; margin-bottom: 10px;">File yang akan diproses:</p>';
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span class="file-item-name">üìÑ ${file.name}</span>
                    <button class="file-item-remove" onclick="removeFile(${index})">Hapus</button>
                `;
                container.appendChild(fileItem);
            });
        }
        
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFileList();
        }
        
        async function processAllFiles() {
            if (selectedFiles.length === 0) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('processBtn').disabled = true;
            
            allStudentsData = [];
            
            for (const file of selectedFiles) {
                try {
                    const data = await readExcelFile(file);
                    allStudentsData = [...allStudentsData, ...data];
                } catch (error) {
                    console.error('Error reading file:', file.name, error);
                    alert(`Error membaca file ${file.name}: ${error.message}`);
                }
            }
            
            if (allStudentsData.length > 0) {
                processData();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('uploadSection').style.display = 'none';
                document.getElementById('programFilter').style.display = 'block';
                document.getElementById('tabsSection').style.display = 'flex';
                
                renderProgramFilter();
                renderProgramBadges();
                renderOverview();
                renderCharts();
                renderInsights();
                renderTable();
            } else {
                document.getElementById('loading').style.display = 'none';
                alert('Tidak ada data yang berhasil dibaca dari file.');
                document.getElementById('processBtn').disabled = false;
            }
        }
        
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        resolve(jsonData);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = function(error) {
                    reject(error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        function processData() {
            allStudentsData = allStudentsData.map((row, index) => ({
                id: index + 1,
                timestamp: row['Cap waktu'],
                email: row['Nama pengguna'],
                program: row['Pilih Program Studi'],
                nimName: row['Pillih NIM dan Nama Kamu:'],
                workingProfessional: row['Apakah saat ini (Semester Ganjil 2025) kamu sedang dalam bekerja secara profesional ?'],
                activities: row['Kegiatan saat ini (Semester Ganjil 2025) yang kamu kerjakan selain Kuliah?'],
                activityDetails: row['Tuliskan jenis Kegiatan yang kamu pilih sebelumnya? Contoh: Jika memilih Lomba, tulisankan Judul Lomba dan sedang tahap apa Lombanya, begitupun dengan pilihan lainnya '],
                willingToWork: row['Jika saat ini kamu tidak sedang bekerja, apakah kamu bersedia menerima tawaran kerja atau magang (internship) dari CDC? '],
                workType: row['Apakah saat ini kamu sedang bekerja secara?'],
                company: row['Tuliskan nama perusahaan/institusi tempat kamu bekerja saat ini?'],
                profession: row['Tuliskan Profesi Pekerjaan kamu saat ini? Contoh: Data Analyst, Web Developer, dll.'],
                employmentStatus: row['Pilih Status Pekerjaan kamu saat ini?']
            }));
            
            // Get unique programs
            availablePrograms = [...new Set(allStudentsData.map(s => s.program).filter(p => p))];
            filteredData = [...allStudentsData];
        }
        
        function renderProgramBadges() {
            const container = document.getElementById('programBadges');
            container.innerHTML = availablePrograms.map(prog => 
                `<span class="program-badge">${prog}</span>`
            ).join('');
        }
        
        function renderProgramFilter() {
            const container = document.getElementById('filterButtons');
            
            let html = `<button class="filter-btn active" onclick="filterByProgram('all')">
                üìö Semua Program (${allStudentsData.length})
            </button>`;
            
            availablePrograms.forEach(program => {
                const count = allStudentsData.filter(s => s.program === program).length;
                html += `<button class="filter-btn" onclick="filterByProgram('${program}')">
                    üéì ${program} (${count})
                </button>`;
            });
            
            container.innerHTML = html;
        }
        
        function filterByProgram(program) {
            currentProgramFilter = program;
            
            // Update button states
            document.querySelectorAll('#filterButtons .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter data
            if (program === 'all') {
                filteredData = [...allStudentsData];
            } else {
                filteredData = allStudentsData.filter(s => s.program === program);
            }
            
            // Re-render all sections
            renderOverview();
            renderCharts();
            renderInsights();
            updateTableContent();
        }
        
        function renderOverview() {
            const grid = document.getElementById('statsGrid');
            
            const workingCount = filteredData.filter(s => s.workingProfessional === 'Ya').length;
            const notWorkingCount = filteredData.filter(s => s.workingProfessional === 'Tidak').length;
            const willingCount = filteredData.filter(s => s.willingToWork === 'Ya').length;
            const fullTimeCount = filteredData.filter(s => s.workType === 'Full Time').length;
            
            const workingPercentage = filteredData.length > 0 ? ((workingCount / filteredData.length) * 100).toFixed(1) : 0;
            const willingPercentage = notWorkingCount > 0 ? ((willingCount / notWorkingCount) * 100).toFixed(1) : 0;
            
            const programText = currentProgramFilter === 'all' ? 'Semua Program' : currentProgramFilter;
            
            grid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-label">Total Mahasiswa</div>
                    <div class="stat-value">${filteredData.length}</div>
                    <div class="stat-subtext">${programText}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üíº</div>
                    <div class="stat-label">Sedang Bekerja</div>
                    <div class="stat-value">${workingCount}</div>
                    <div class="stat-subtext">${workingPercentage}% dari total mahasiswa</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-label">Bersedia Bekerja</div>
                    <div class="stat-value">${willingCount}</div>
                    <div class="stat-subtext">${willingPercentage}% dari yang belum bekerja</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚è∞</div>
                    <div class="stat-label">Full Time</div>
                    <div class="stat-value">${fullTimeCount}</div>
                    <div class="stat-subtext">Dari ${workingCount} yang bekerja</div>
                </div>
            `;
            
            grid.style.display = 'grid';
        }
        
        function renderCharts() {
            const section = document.getElementById('chartsSection');
            
            // Destroy existing charts
            Object.values(chartInstances).forEach(chart => chart.destroy());
            chartInstances = {};
            
            section.innerHTML = `
                ${currentProgramFilter === 'all' && availablePrograms.length > 1 ? `
                <div class="chart-container">
                    <h3>üéì Distribusi Mahasiswa per Program Studi</h3>
                    <div class="chart-wrapper small">
                        <canvas id="programDistChart"></canvas>
                    </div>
                </div>
                ` : ''}
                
                <div class="chart-container">
                    <h3>üìä Status Pekerjaan Profesional</h3>
                    <div class="chart-wrapper small">
                        <canvas id="workStatusChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üìà Kegiatan Mahasiswa Selain Kuliah</h3>
                    <div class="chart-wrapper">
                        <canvas id="activitiesChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üíº Tipe Pekerjaan</h3>
                    <div class="chart-wrapper small">
                        <canvas id="workTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üìã Status Kepegawaian</h3>
                    <div class="chart-wrapper small">
                        <canvas id="employmentStatusChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üè¢ Top 10 Perusahaan</h3>
                    <div class="chart-wrapper">
                        <canvas id="companiesChart"></canvas>
                    </div>
                </div>
            `;
            
            section.style.display = 'block';
            
            // Render charts
            if (currentProgramFilter === 'all' && availablePrograms.length > 1) {
                renderProgramDistributionChart();
            }
            renderWorkStatusChart();
            renderActivitiesChart();
            renderWorkTypeChart();
            renderEmploymentStatusChart();
            renderCompaniesChart();
        }
        
        function renderProgramDistributionChart() {
            const programCounts = {};
            availablePrograms.forEach(prog => {
                programCounts[prog] = allStudentsData.filter(s => s.program === prog).length;
            });
            
            const canvas = document.getElementById('programDistChart');
            if (!canvas) return;
            
            chartInstances['programDist'] = new Chart(canvas, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(programCounts),
                    datasets: [{
                        data: Object.values(programCounts),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }
        
        function renderWorkStatusChart() {
            const workStatus = getCountData('workingProfessional');
            const canvas = document.getElementById('workStatusChart');
            if (!canvas) return;
            
            chartInstances['workStatus'] = new Chart(canvas, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(workStatus),
                    datasets: [{
                        data: Object.values(workStatus),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }
        
        function renderActivitiesChart() {
            const activities = getActivitiesData();
            const canvas = document.getElementById('activitiesChart');
            if (!canvas) return;
            
            chartInstances['activities'] = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: Object.keys(activities),
                    datasets: [{
                        label: 'Jumlah Mahasiswa',
                        data: Object.values(activities),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { font: { size: 12 } }
                        },
                        y: {
                            ticks: { font: { size: 12 } }
                        }
                    }
                }
            });
        }
        
        function renderWorkTypeChart() {
            const workType = getCountData('workType');
            const canvas = document.getElementById('workTypeChart');
            if (!canvas) return;
            
            chartInstances['workType'] = new Chart(canvas, {
                type: 'pie',
                data: {
                    labels: Object.keys(workType),
                    datasets: [{
                        data: Object.values(workType),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }
        
        function renderEmploymentStatusChart() {
            const empStatus = getCountData('employmentStatus');
            const canvas = document.getElementById('employmentStatusChart');
            if (!canvas) return;
            
            chartInstances['employmentStatus'] = new Chart(canvas, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(empStatus),
                    datasets: [{
                        data: Object.values(empStatus),
                        backgroundColor: ['#667eea', '#764ba2'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }
        
        function renderCompaniesChart() {
            const companies = getTopCompanies(10);
            const canvas = document.getElementById('companiesChart');
            if (!canvas) return;
            
            chartInstances['companies'] = new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: Object.keys(companies),
                    datasets: [{
                        label: 'Jumlah Mahasiswa',
                        data: Object.values(companies),
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { 
                                font: { size: 12 },
                                stepSize: 1
                            }
                        },
                        y: {
                            ticks: { font: { size: 11 } }
                        }
                    }
                }
            });
        }
        
        function renderInsights() {
            const section = document.getElementById('insightsSection');
            
            const workingCount = filteredData.filter(s => s.workingProfessional === 'Ya').length;
            const notWorkingCount = filteredData.filter(s => s.workingProfessional === 'Tidak').length;
            const willingCount = filteredData.filter(s => s.willingToWork === 'Ya').length;
            const fullTimeCount = filteredData.filter(s => s.workType === 'Full Time').length;
            const contractCount = filteredData.filter(s => s.employmentStatus === 'Kontrak').length;
            const permanentCount = filteredData.filter(s => s.employmentStatus === 'Tetap / Permanen').length;
            
            const activities = getActivitiesData();
            const topActivity = Object.entries(activities).sort((a, b) => b[1] - a[1])[0] || ['N/A', 0];
            
            const programText = currentProgramFilter === 'all' ? 'semua program' : `Program ${currentProgramFilter}`;
            
            let html = `
                <div class="insight-card">
                    <h4>üéØ Tingkat Partisipasi Kerja</h4>
                    <p>Dari <strong>${filteredData.length} mahasiswa</strong> ${programText}, sebanyak <strong>${workingCount} mahasiswa (${((workingCount / filteredData.length) * 100).toFixed(1)}%)</strong> saat ini sedang bekerja secara profesional.</p>
                    <p>Ini menunjukkan <strong>distribusi yang ${Math.abs(workingCount - notWorkingCount) < 10 ? 'seimbang' : 'bervariasi'}</strong> antara mahasiswa yang fokus kuliah dan yang sudah mulai bekerja.</p>
                    <div class="insight-highlight">
                        ‚ú® Rasio Bekerja:Kuliah = ${workingCount}:${notWorkingCount}
                    </div>
                </div>
            `;
            
            if (notWorkingCount > 0) {
                html += `
                    <div class="insight-card">
                        <h4>üíº Kesediaan Bekerja</h4>
                        <p>Dari <strong>${notWorkingCount} mahasiswa</strong> yang belum bekerja, sebanyak <strong>${willingCount} mahasiswa (${((willingCount / notWorkingCount) * 100).toFixed(1)}%)</strong> menyatakan bersedia menerima tawaran kerja atau magang.</p>
                        <p>Ini menunjukkan <strong>antusiasme ${willingCount / notWorkingCount > 0.8 ? 'tinggi' : 'sedang'}</strong> untuk memasuki dunia kerja.</p>
                        <div class="insight-highlight">
                            üöÄ Job Market Readiness: ${((willingCount / notWorkingCount) * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
            }
            
            if (topActivity[1] > 0) {
                html += `
                    <div class="insight-card">
                        <h4>üìä Aktivitas Mahasiswa</h4>
                        <p>Aktivitas paling populer di kalangan mahasiswa adalah <strong>"${topActivity[0]}"</strong> dengan <strong>${topActivity[1]} mahasiswa</strong>.</p>
                        <p>Ini menunjukkan mahasiswa <strong>aktif mengembangkan skill</strong> melalui berbagai kegiatan.</p>
                        <div class="insight-highlight">
                            üí° Top Activity: ${topActivity[0]} (${topActivity[1]} mahasiswa)
                        </div>
                    </div>
                `;
            }
            
            if (workingCount > 0) {
                html += `
                    <div class="insight-card">
                        <h4>‚è∞ Tipe Pekerjaan</h4>
                        <p>Dari mahasiswa yang bekerja, <strong>${fullTimeCount} mahasiswa</strong> bekerja Full Time, menunjukkan komitmen tinggi terhadap karir.</p>
                        <p>Mayoritas posisi adalah <strong>kontrak (${contractCount})</strong> vs permanen (${permanentCount}), yang umum untuk fresh graduate.</p>
                        <div class="insight-highlight">
                            üìà Full Time Workers: ${((fullTimeCount / workingCount) * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div class="insight-card">
                    <h4>üéì Rekomendasi CDC</h4>
                    <p><strong>Peluang Placement:</strong> Terdapat ${willingCount} mahasiswa yang siap untuk program kerja/magang.</p>
                    <p><strong>Focus Area:</strong> ${topActivity[0]} sangat diminati mahasiswa.</p>
                    <p><strong>Industry Partnership:</strong> Diversifikasi perusahaan partner untuk berbagai level experience.</p>
                    <div class="insight-highlight">
                        üéØ Action Item: ${willingCount} mahasiswa siap untuk placement program
                    </div>
                </div>
            `;
            
            section.innerHTML = html;
            section.style.display = 'block';
        }
        
        function renderTable() {
            const section = document.getElementById('tableSection');
            
            section.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">üìã Data Mahasiswa Lengkap</h3>
                
                <div class="table-controls">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="üîç Cari berdasarkan nama, NIM, email, perusahaan..." onkeyup="filterTable()">
                    </div>
                    <div class="filter-controls">
                        <button class="filter-btn active" onclick="filterByStatus('all')">Semua</button>
                        <button class="filter-btn" onclick="filterByStatus('working')">Bekerja</button>
                        <button class="filter-btn" onclick="filterByStatus('not-working')">Belum Bekerja</button>
                        <button class="export-btn" onclick="exportToExcel()">üì• Export Excel</button>
                    </div>
                </div>
                
                <div style="overflow-x: auto;">
                    <table id="studentsTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Program Studi</th>
                                <th>NIM & Nama</th>
                                <th>Email</th>
                                <th>Status Kerja</th>
                                <th>Aktivitas</th>
                                <th>Perusahaan</th>
                                <th>Posisi</th>
                                <th>Tipe</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
                
                <div id="tableInfo" style="margin-top: 20px; color: #666; text-align: center;"></div>
            `;
            
            section.style.display = 'block';
            updateTableContent();
        }
        
        function updateTableContent() {
            const tbody = document.getElementById('tableBody');
            const info = document.getElementById('tableInfo');
            
            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: #999;">Tidak ada data yang sesuai dengan filter</td></tr>';
                info.textContent = '';
                return;
            }
            
            tbody.innerHTML = filteredData.map((student, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <span class="badge ${student.program === 'Sains Data' ? 'badge-primary' : 'badge-purple'}">
                            ${student.program || '-'}
                        </span>
                    </td>
                    <td><strong>${student.nimName || '-'}</strong></td>
                    <td>${student.email || '-'}</td>
                    <td>
                        <span class="badge ${student.workingProfessional === 'Ya' ? 'badge-success' : 'badge-warning'}">
                            ${student.workingProfessional === 'Ya' ? '‚úì Bekerja' : '‚úó Belum'}
                        </span>
                    </td>
                    <td>${student.activities || '-'}</td>
                    <td>${student.company || '-'}</td>
                    <td>${student.profession || '-'}</td>
                    <td>
                        ${student.workType ? `<span class="badge badge-info">${student.workType}</span>` : '-'}
                    </td>
                    <td>
                        ${student.employmentStatus ? `<span class="badge badge-secondary">${student.employmentStatus}</span>` : '-'}
                    </td>
                </tr>
            `).join('');
            
            info.textContent = `Menampilkan ${filteredData.length} dari ${allStudentsData.length} mahasiswa`;
        }
        
        function filterByStatus(status) {
            // Update button states
            document.querySelectorAll('.table-controls .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Get base data based on program filter
            let baseData = currentProgramFilter === 'all' 
                ? [...allStudentsData] 
                : allStudentsData.filter(s => s.program === currentProgramFilter);
            
            if (status === 'all') {
                filteredData = baseData;
            } else if (status === 'working') {
                filteredData = baseData.filter(s => s.workingProfessional === 'Ya');
            } else if (status === 'not-working') {
                filteredData = baseData.filter(s => s.workingProfessional === 'Tidak');
            }
            
            updateTableContent();
        }
        
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Get base data based on program filter
            let baseData = currentProgramFilter === 'all' 
                ? [...allStudentsData] 
                : allStudentsData.filter(s => s.program === currentProgramFilter);
            
            filteredData = baseData.filter(student => {
                return (
                    (student.nimName || '').toLowerCase().includes(searchTerm) ||
                    (student.email || '').toLowerCase().includes(searchTerm) ||
                    (student.company || '').toLowerCase().includes(searchTerm) ||
                    (student.profession || '').toLowerCase().includes(searchTerm) ||
                    (student.activities || '').toLowerCase().includes(searchTerm) ||
                    (student.program || '').toLowerCase().includes(searchTerm)
                );
            });
            
            updateTableContent();
        }
        
        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(filteredData.map((s, i) => ({
                'No': i + 1,
                'Program Studi': s.program,
                'NIM & Nama': s.nimName,
                'Email': s.email,
                'Status Kerja': s.workingProfessional,
                'Aktivitas': s.activities,
                'Detail Aktivitas': s.activityDetails,
                'Bersedia Bekerja': s.willingToWork,
                'Tipe Pekerjaan': s.workType,
                'Perusahaan': s.company,
                'Posisi': s.profession,
                'Status Kepegawaian': s.employmentStatus
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Students Data');
            
            const programSuffix = currentProgramFilter === 'all' ? 'All_Programs' : currentProgramFilter.replace(/\s+/g, '_');
            XLSX.writeFile(wb, `Mahasiswa_Analysis_${programSuffix}_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
        
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
        }
        
        // Helper functions
        function getCountData(field) {
            const counts = {};
            filteredData.forEach(student => {
                const value = student[field];
                if (value && value !== '-' && value !== 'tidak ada' && value !== 'Tidak ada') {
                    counts[value] = (counts[value] || 0) + 1;
                }
            });
            return counts;
        }
        
        function getActivitiesData() {
            const activities = {};
            filteredData.forEach(student => {
                if (student.activities && student.activities !== '-' && student.activities !== 'tidak ada' && student.activities !== 'Tidak ada') {
                    const acts = student.activities.split(';').map(a => a.trim());
                    acts.forEach(act => {
                        if (act) {
                            activities[act] = (activities[act] || 0) + 1;
                        }
                    });
                }
            });
            return Object.fromEntries(
                Object.entries(activities)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
            );
        }
        
        function getTopCompanies(limit) {
            const companies = {};
            filteredData.forEach(student => {
                if (student.company && student.company !== '-') {
                    companies[student.company] = (companies[student.company] || 0) + 1;
                }
            });
            return Object.fromEntries(
                Object.entries(companies)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, limit)
            );
        }
    </script>
</body>
</html>
